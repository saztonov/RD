# –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞–º–∏ OCR

## –û–±–∑–æ—Ä

–í –≤–µ—Ä—Å–∏–∏ 1.2.0 –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.

–í—Å–µ –ø—Ä–æ–º–ø—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `prompts/` –≤ –≤–∏–¥–µ `.txt` —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –ª—é–±–æ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
prompts/
‚îú‚îÄ‚îÄ ocr_text.txt              # TEXT –±–ª–æ–∫–∏
‚îú‚îÄ‚îÄ ocr_table.txt             # TABLE –±–ª–æ–∫–∏  
‚îú‚îÄ‚îÄ ocr_image_description.txt # IMAGE –±–ª–æ–∫–∏
‚îú‚îÄ‚îÄ ocr_full_page.txt         # –ü–æ–ª–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îú‚îÄ‚îÄ README.md                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –ø—Ä–æ–º–ø—Ç–∞–º
‚îú‚îÄ‚îÄ QUICK_EDIT.md             # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
‚îî‚îÄ‚îÄ .gitignore.example        # –ü—Ä–∏–º–µ—Ä .gitignore
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞–π–¥–∏—Ç–µ –Ω—É–∂–Ω—ã–π —Ñ–∞–π–ª

| –•–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å | –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª |
|----------------|---------------|
| –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π | `prompts/ocr_image_description.txt` |
| –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ | `prompts/ocr_text.txt` |
| –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü | `prompts/ocr_table.txt` |
| –ü–æ–ª–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ | `prompts/ocr_full_page.txt` |

### 2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–æ–º–ø—Ç

```bash
# Windows
notepad prompts\ocr_image_description.txt

# Linux/Mac
nano prompts/ocr_image_description.txt
```

–ü—Ä–∏–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏—è:
```
–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ OCR

–ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ OCR.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤

```python
from app.ocr import load_prompt

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ prompts/ocr_text.txt
text_prompt = load_prompt("ocr_text.txt")
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ OCR

```python
# LocalVLM backend
ocr_engine = create_ocr_engine("local_vlm")

# –ü—Ä–æ–º–ø—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ç–∏–ø—É –±–ª–æ–∫–∞
if block.block_type == BlockType.IMAGE:
    prompt = load_prompt("ocr_image_description.txt")
    block.ocr_text = ocr_engine.recognize(crop, prompt=prompt)
```

### Fallback –º–µ—Ö–∞–Ω–∏–∑–º

–ï—Å–ª–∏ —Ñ–∞–π–ª –ø—Ä–æ–º–ø—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π fallback:

```python
if not prompt:
    prompt = "–†–∞—Å–ø–æ–∑–Ω–∞–π —Ç–µ–∫—Å—Ç..."  # –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ö—Ä–∞—Ç–∫–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–§–∞–π–ª:** `prompts/ocr_image_description.txt`

```
–û–ø–∏—à–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—Ä–∞—Ç–∫–æ (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) –Ω–∞ —Ä—É—Å—Å–∫–æ–º.
```

### –ü—Ä–∏–º–µ—Ä 2: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —á–µ—Ä—Ç–µ–∂–∏

**–§–∞–π–ª:** `prompts/ocr_image_description.txt`

```
–û–ø–∏—à–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —á–µ—Ä—Ç—ë–∂:
- –¢–∏–ø (–ø–ª–∞–Ω, —Ñ–∞—Å–∞–¥, —Ä–∞–∑—Ä–µ–∑)
- –ú–∞—Å—à—Ç–∞–±
- –†–∞–∑–º–µ—Ä—ã
- –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é
```

### –ü—Ä–∏–º–µ—Ä 3: –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã

**–§–∞–π–ª:** `prompts/ocr_table.txt`

```
–†–∞—Å–ø–æ–∑–Ω–∞–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É –≤ Markdown —Ñ–æ—Ä–º–∞—Ç–µ.
–û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ:
- –¢–æ—á–Ω–æ—Å—Ç—å —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- –í–∞–ª—é—Ç—ã –∏ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è
- –ò—Ç–æ–≥–æ–≤—ã–µ —Å—É–º–º—ã
–ü—Ä–æ–≤–µ—Ä—å –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫—É.
```

### –ü—Ä–∏–º–µ—Ä 4: –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã–π —Ä–µ–∂–∏–º

**–§–∞–π–ª:** `prompts/ocr_text.txt`

```
Extract all text from image.
Preserve document structure: headings, paragraphs, lists.
Output format: Markdown.
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞** - —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ç–æ–ª—å–∫–æ .txt —Ñ–∞–π–ª—ã  
‚úÖ **–ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Å—Ä–∞–∑—É  
‚úÖ **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ö—Ä–∞–Ω–∏—Ç–µ —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤  
‚úÖ **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤  
‚úÖ **–û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π** - –ª–µ–≥–∫–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏  

## –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–æ–º–ø—Ç—ã

### GUI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Üí –ó–∞–ø—É—Å—Ç–∏—Ç—å OCR (Ctrl+R)
‚Üí –†–µ–∂–∏–º: –ü–æ –±–ª–æ–∫–∞–º
‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–æ–º–ø—Ç—ã –ø–æ —Ç–∏–ø—É –±–ª–æ–∫–∞
```

### Python API

```python
from app.ocr import create_ocr_engine, load_prompt

# –°–æ–∑–¥–∞—Ç—å –¥–≤–∏–∂–æ–∫
ocr = create_ocr_engine("local_vlm")

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
custom_prompt = load_prompt("ocr_image_description.txt")

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
result = ocr.recognize(image, prompt=custom_prompt)
```

### –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞

–ü—Ä–æ–º–ø—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ CLI.

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –õ–æ–∫–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤

```python
PROMPTS_DIR = Path(__file__).parent.parent / "prompts"
# C:\Users\svarovsky\PycharmProjects\RD\prompts\
```

### –ö–æ–¥–∏—Ä–æ–≤–∫–∞

–§–∞–π–ª—ã –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ **UTF-8**.

### –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏

```python
def load_prompt(prompt_file: str) -> str:
    """
    –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞
    
    Args:
        prompt_file: –∏–º—è —Ñ–∞–π–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä "ocr_text.txt")
    
    Returns:
        –¢–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞ –∏–ª–∏ "" –ø—Ä–∏ –æ—à–∏–±–∫–µ
    """
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–º–ø—Ç–∞ –ø–∏—à–µ—Ç—Å—è –≤ –ª–æ–≥:

```
DEBUG:app.ocr:–ü—Ä–æ–º–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ ocr_text.txt
WARNING:app.ocr:–§–∞–π–ª –ø—Ä–æ–º–ø—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω: prompts/ocr_custom.txt
```

## –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤ `prompts/`:
   ```bash
   echo "–û–ø–∏—à–∏ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫—É—é —Å—Ö–µ–º—É..." > prompts/ocr_electrical.txt
   ```

2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ –∫–æ–¥–µ:
   ```python
   electrical_prompt = load_prompt("ocr_electrical.txt")
   result = ocr.recognize(image, prompt=electrical_prompt)
   ```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏

```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
cp prompts/ocr_image_description.txt prompts/ocr_image_description.txt.v1

# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
nano prompts/ocr_image_description.txt

# –û—Ç–∫–∞—Ç–∏—Ç—å—Å—è –µ—Å–ª–∏ –Ω–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å
cp prompts/ocr_image_description.txt.v1 prompts/ocr_image_description.txt
```

### Git workflow

```bash
# –ù–µ –∫–æ–º–º–∏—Ç–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
cp prompts/.gitignore.example prompts/.gitignore

# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ .gitignore:
# ocr_*.txt

# –ö–æ–º–º–∏—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
git add prompts/*.md
```

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

üìñ **[–ü–æ–¥—Ä–æ–±–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](docs/PROMPTS_CUSTOMIZATION.md)** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ  
üìñ **[–ë—ã—Å—Ç—Ä–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](prompts/QUICK_EDIT.md)** - 3 –ø—Ä–æ—Å—Ç—ã—Ö —à–∞–≥–∞  
üìñ **[–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–º–ø—Ç–æ–≤](prompts/README.md)** - –≥–æ—Ç–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã  
üìñ **[Marker OCR](docs/MARKER_OCR_INTEGRATION.md)** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–∞–∑–º–µ—Ç–∫–æ–π  

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–æ–º–ø—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥–∏—Ä–æ–≤–∫—É UTF-8
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
4. –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ (DEBUG —Ä–µ–∂–∏–º)

### –ü—Ä–æ–±–ª–µ–º–∞: VLM –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥–µ–ª–∏ –ª—É—á—à–µ —Å–ª–µ–¥—É—é—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
2. –£–ø—Ä–æ—Å—Ç–∏—Ç–µ –ø—Ä–æ–º–ø—Ç
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å
4. –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –≤ –ø—Ä–æ–º–ø—Ç

## Roadmap

**v1.3:**
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö `{block_type}`, `{language}`
- [ ] GUI —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–æ–≤
- [ ] –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≥–æ—Ç–æ–≤—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤

**v1.4:**
- [ ] –®–∞–±–ª–æ–Ω—ã –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∏–Ω–¥—É—Å—Ç—Ä–∏–π
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥–±–æ—Ä –ø—Ä–æ–º–ø—Ç–∞ –ø–æ —Ç–∏–ø—É –¥–æ–∫—É–º–µ–Ω—Ç–∞
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–º–ø—Ç–æ–≤

## Changelog

**v1.2.0** (2025-11-30)
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
- ‚úÖ 4 –±–∞–∑–æ–≤—ã—Ö –ø—Ä–æ–º–ø—Ç–∞ (text, table, image, full_page)
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `load_prompt()`
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã

---

**–í–µ—Ä—Å–∏—è:** 1.2.0  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 2025-11-30

