-- Миграция: добавление retry_count для защиты от бесконечного зацикливания OCR задач
-- Дата: 2026-01-31
-- Проблема: задачи могут бесконечно перезапускаться при таймаутах Celery,
--           т.к. max_retries работает только для явных self.retry() вызовов

-- Добавляем поле retry_count для отслеживания количества попыток
ALTER TABLE jobs ADD COLUMN IF NOT EXISTS retry_count INTEGER DEFAULT 0;

-- Комментарий к полю
COMMENT ON COLUMN jobs.retry_count IS 'Количество попыток выполнения задачи (защита от бесконечного зацикливания)';
