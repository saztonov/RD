# Отладочное логирование - поиск проблемы с закрытием программы

## Активировано подробное логирование

Уровень: **DEBUG** (все события детально)

## Где смотреть логи

### 1. Консоль PowerShell
```powershell
python -m app.main
```
Все логи выводятся прямо в консоль в реальном времени.

### 2. Файл логов
```
logs\app.log
```

## Как воспроизвести проблему

1. Запустить:
```powershell
python -m app.main
```

2. Открыть большой PDF файл

3. Нажать **Инструменты → Удалить штампы** (или Ctrl+D)

4. **Следить за консолью!** - в момент закрытия программы там будут логи

## Что показывают логи

### Точки логирования:

```
[MainWindow] Запуск удаления штампов
[MainWindow] Импорт StampRemoverDialog
[MainWindow] Создание диалога удаления штампов
[StampRemover] Инициализация диалога для: ...
[Analyzer] Инициализация для: ...
[StampRemover] Настройка UI...
[StampRemover] Загрузка структуры...
[StampRemover] Начало загрузки структуры
[Analyzer] Открытие документа: ...
[Analyzer] Документ открыт успешно, страниц: XX
[StampRemover] Анализ страницы X/XX
[StampRemover] Страница X: найдено Y элементов
...
[StampRemover] Анализ завершен
[StampRemover] Обновление дерева
[StampRemover] Отображение предпросмотра
[StampRemover] Предпросмотр страницы 0
...
```

## Поиск проблемы

**Последняя запись перед крашем** покажет где именно падает программа.

### Возможные причины:

1. **Ошибка при открытии PDF**: `[Analyzer] Ошибка открытия PDF`
2. **Ошибка анализа страницы**: `[Analyzer] Ошибка получения страницы`
3. **Ошибка предпросмотра**: `[StampRemover] Ошибка предпросмотра`
4. **Ошибка Qt UI**: проблемы с созданием виджетов
5. **Memory**: нехватка памяти для большого PDF

## Получение логов

Скопируйте **ВСЕ** логи из консоли, начиная с:
```
====================================
PDF Annotation Tool - запуск приложения
====================================
```

И до момента краша/закрытия программы.

## Временное отключение подробных логов

Если логов слишком много, в `app/main.py` измените:
```python
setup_logging(log_level=logging.INFO)  # вместо DEBUG
```

## Пример вывода при ошибке

```
[MainWindow] Запуск удаления штампов
[MainWindow] Импорт StampRemoverDialog
[MainWindow] Создание диалога удаления штампов
[StampRemover] Инициализация диалога для: C:/path/to/file.pdf
[Analyzer] Инициализация для: C:/path/to/file.pdf
[StampRemover] Настройка UI...
[StampRemover] Загрузка структуры...
[StampRemover] Начало загрузки структуры
[Analyzer] Открытие документа: C:/path/to/file.pdf
[Analyzer] Ошибка открытия PDF: Cannot open file
Traceback (most recent call last):
  ...
```

**↑ Это и нужно для диагностики!**

