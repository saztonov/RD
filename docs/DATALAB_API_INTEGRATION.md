# Интеграция Datalab API для автоматической разметки

## Описание

Datalab API предоставляет мощный инструмент для автоматической разметки PDF документов с использованием Layout Analysis. Это позволяет автоматически определять:
- Текстовые блоки
- Таблицы
- Изображения
- Порядок чтения

## Настройка

### Получение API ключа

1. Зарегистрируйтесь на [datalab.to](https://www.datalab.to/)
2. Получите API ключ в личном кабинете
3. Создайте файл `.env` в корне проекта:

```bash
# Скопируйте env.example в .env
copy env.example .env
```

Откройте `.env` и укажите ваш ключ:
```
DATALAB_API_KEY=ваш_api_ключ
```

**Альтернатива:** Установите переменную окружения или введите ключ в диалоге.

## Использование в приложении

### Через меню
- **Инструменты → Datalab разметка** (`Ctrl+D`) - разметка текущей страницы
- **Инструменты → Datalab (все стр.)** (`Ctrl+Shift+D`) - разметка всех страниц

### Через кнопки
В правой панели доступны кнопки:
- **Datalab разметка** - разметка текущей страницы
- **Datalab (все стр.)** - разметка всего документа

## Процесс работы

1. Откройте PDF документ
2. (Опционально) Выберите категорию для создаваемых блоков
3. Нажмите кнопку или используйте горячую клавишу
4. Введите API ключ (если не установлен в окружении)
5. Дождитесь завершения анализа
6. Блоки будут добавлены на страницы

## Особенности

- Datalab API работает через облачный сервис
- Требуется интернет-соединение
- Обрабатываются все страницы или выбранные
- Новые блоки не заменяют существующие, а дополняют их
- Пересекающиеся блоки автоматически фильтруются

## API Endpoints

Используемые эндпоинты:
- `POST /api/v1/layout` - запуск Layout анализа (с прямой загрузкой PDF файла)
- `GET /api/v1/layout/{task_id}/status` - проверка статуса задачи

## Документация

- [Datalab API Reference](https://documentation.datalab.to/api-reference)
- [Layout Analysis](https://documentation.datalab.to/api-reference/layout)
- [GitHub: datalab-to/surya](https://github.com/datalab-to/surya)

## Troubleshooting

### Ошибка "API key не найден"
1. Проверьте наличие файла `.env` в корне проекта
2. Убедитесь, что ключ указан: `DATALAB_API_KEY=your_key`
3. Перезапустите приложение после создания `.env`

Альтернатива: введите ключ в диалоговом окне при запуске

### Ошибка "Layout задача не завершилась"
Увеличьте время ожидания в `datalab_integration.py` (параметр `max_attempts`).

### Блоки не добавляются
Проверьте:
- Правильность API ключа
- Наличие интернет-соединения
- Логи приложения (`logs/app.log`)

### python-dotenv не установлен
Установите зависимости:
```bash
pip install -r requirements.txt
```

