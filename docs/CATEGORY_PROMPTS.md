# –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π

## –û–ø–∏—Å–∞–Ω–∏–µ

–ö–∞–∂–¥–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –±–ª–æ–∫–æ–≤ –∏–º–µ–µ—Ç —Å–≤–æ–π –ø—Ä–æ–º–ø—Ç –¥–ª—è OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ R2 Storage.

## –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è 3 —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
- **–¢–µ–∫—Å—Ç** - –ø—Ä–æ–º–ø—Ç –∏–∑ `prompts/text.txt`
- **–¢–∞–±–ª–∏—Ü–∞** - –ø—Ä–æ–º–ø—Ç –∏–∑ `prompts/table.txt`
- **–ö–∞—Ä—Ç–∏–Ω–∫–∞** - –ø—Ä–æ–º–ø—Ç –∏–∑ `prompts/image.txt`

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å, —Ç–æ–ª—å–∫–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –ø—Ä–æ–º–ø—Ç—ã.

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–º–ø—Ç–æ–≤

–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –±–ª–æ–∫–∞ –Ω–∞ OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:

1. **–ü—Ä–æ–º–ø—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** (–µ—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –∑–∞–¥–∞–Ω–∞ –∏ –ø—Ä–æ–º–ø—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
2. **–ü—Ä–æ–º–ø—Ç —Ç–∏–ø–∞ –±–ª–æ–∫–∞** (text/table/image)

## –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ R2

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª—é—á–µ–π

- `prompts/categories_list.txt` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ —Å—Ç—Ä–æ–∫—É)
- `prompts/category_{–Ω–∞–∑–≤–∞–Ω–∏–µ_–∫–∞—Ç–µ–≥–æ—Ä–∏–∏}.txt` - –ø—Ä–æ–º–ø—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `prompts/text.txt` - –ø—Ä–æ–º–ø—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤
- `prompts/table.txt` - –ø—Ä–æ–º–ø—Ç –¥–ª—è —Ç–∞–±–ª–∏—á–Ω—ã—Ö –±–ª–æ–∫–æ–≤
- `prompts/image.txt` - –ø—Ä–æ–º–ø—Ç –¥–ª—è –±–ª–æ–∫–æ–≤-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è** —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –∏–∑ –ø–∞–ø–∫–∏ `prompts/` –≤ R2
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ `prompts/categories_list.txt`
3. –°–æ–∑–¥–∞—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏ –∏–∑ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
4. –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏
5. –ü—Ä–æ–º–ø—Ç—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –ø—Ä–∏ OCR –∏–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

**–í–∞–∂–Ω–æ:** –ü—Ä–æ–º–ø—Ç—ã –∏–∑ –ø–∞–ø–∫–∏ `prompts/` –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ R2 –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## UI —Ñ—É–Ω–∫—Ü–∏–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ö–Ω–æ–ø–∫–∞ `‚ûï` –∏–ª–∏ –≤–≤–æ–¥ –≤ –ø–æ–ª–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –î–ª—è –Ω–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å–æ–∑–¥–∞–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç-—à–∞–±–ª–æ–Ω
- –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–æ–º–ø—Ç—ã –∏–∑ `prompts/`
- –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ R2

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ö–Ω–æ–ø–∫–∞ `‚úèÔ∏è –ü—Ä–æ–º—Ç` –≤ –ø–∞–Ω–µ–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º—Ç"
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º
- –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ R2

### –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é"
- **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** (–¢–µ–∫—Å—Ç, –¢–∞–±–ª–∏—Ü–∞, –ö–∞—Ä—Ç–∏–Ω–∫–∞) **–Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –ø—Ä–æ–º–ø—Ç–æ–º –∏–∑ R2
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –≤ R2

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ OCR

–ü—Ä–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–∏ –±–ª–æ–∫–∞ –≤ –º–µ—Ç–æ–¥–µ `OCRManager._get_prompt_for_block()`:

1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É –±–ª–æ–∫–∞
2. –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –µ—Å—Ç—å - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–æ–º–ø—Ç `category_{–∫–∞—Ç–µ–≥–æ—Ä–∏—è}`
3. –ï—Å–ª–∏ –ø—Ä–æ–º–ø—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞–π–¥–µ–Ω - –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
4. –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ–º–ø—Ç —Ç–∏–ø–∞ –±–ª–æ–∫–∞ (text/table/image)

## –ü—Ä–∏–º–µ—Ä

```python
# –ë–ª–æ–∫ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π "–ó–∞–≥–æ–ª–æ–≤–æ–∫"
block.category = "–ó–∞–≥–æ–ª–æ–≤–æ–∫"
block.block_type = BlockType.TEXT

# –ü—Ä–∏ OCR –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø—Ä–æ–º–ø—Ç:
# prompts/category_–ó–∞–≥–æ–ª–æ–≤–æ–∫.txt (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
# –ò–Ω–∞—á–µ: prompts/text.txt
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `app/gui/ocr_manager.py` - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–º–ø—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `app/gui/category_manager.py` - —Ä–∞–±–æ—Ç–∞ —Å R2, —É–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- `app/gui/prompt_manager.py` - –º–µ—Ç–æ–¥—ã –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- `app/gui/panels_setup.py` - UI –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤
- `app/r2_storage.py` - –º–µ—Ç–æ–¥ `list_by_prefix()`

### –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã

**PromptManager:**
- `load_categories_from_r2()` - –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (—Å–æ–∑–¥–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –µ—Å–ª–∏ –Ω–µ—Ç)
- `save_categories_to_r2(categories)` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- `get_category_prompt_name(category)` - –ø–æ–ª—É—á–∏—Ç—å –∏–º—è –ø—Ä–æ–º–ø—Ç–∞
- `delete_prompt(name)` - —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∏–∑ R2
- `ensure_standard_categories()` - —Å–æ–∑–¥–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏
- `_load_local_prompt(filename)` - –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∏–∑ –ø–∞–ø–∫–∏ prompts/

**CategoryManager:**
- `_load_categories_from_r2()` - –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- `_save_categories_to_r2()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞
- `delete_category(category_name)` - —É–¥–∞–ª–µ–Ω–∏–µ —Å –ø—Ä–æ–º–ø—Ç–æ–º (–∑–∞—â–∏—Ç–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö)

**R2Storage:**
- `list_by_prefix(prefix)` - —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É

## –†—É—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã –±–µ–∑ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```bash
python scripts/upload_prompts_to_r2.py
```

–°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∏—Ç –≤—Å–µ `.txt` —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ `prompts/` –≤ R2 Storage.

