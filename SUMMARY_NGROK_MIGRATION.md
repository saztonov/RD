# Summary: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ ngrok API

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### –£–¥–∞–ª–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **–§–∞–π–ª—ã:**
   - `app/marker_integration.py` - –ª–æ–∫–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Marker
   - `docs/MARKER_OCR_INTEGRATION.md`
   - `docs/QUICK_START_MARKER_OCR.md`
   - `docs/LOCAL_VLM_OCR.md`
   - `docs/CHANDRA_OCR.md`

2. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   - `marker-pdf` —É–¥–∞–ª–µ–Ω –∏–∑ requirements.txt
   - `requests` —É–¥–∞–ª–µ–Ω (–∑–∞–º–µ–Ω–µ–Ω –Ω–∞ httpx)

### –°–æ–∑–¥–∞–Ω—ã –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã

1. **app/config.py** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ngrok endpoints
   - `NGROK_BASE_URL = "https://louvred-madie-gigglier.ngrok-free.dev"`
   - `get_marker_base_url()` ‚Üí `/api/v1/segment`
   - `get_lm_base_url()` ‚Üí `/api/v1/lm/chat`

2. **app/segmentation_api.py** - API –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ PDF
   - `segment_with_api()` - –∑–∞–º–µ–Ω–∞ `segment_with_marker()`
   - `segment_pdf_sync()` - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
   - `segment_pdf_async()` - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ page_range, –∫–∞—Ç–µ–≥–æ—Ä–∏–π, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

3. **docs/API_INTEGRATION.md** - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

4. **MIGRATION_NGROK.md** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ñ–∞–π–ª—ã

1. **app/ocr_engines.py**
   - `LocalVLMEngine` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `get_lm_base_url()`
   - –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `httpx.AsyncClient`
   - –£–¥–∞–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `api_base` (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)

2. **app/ocr.py**
   - `LocalVLMBackend` –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ `httpx`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `get_lm_base_url()` –≤–º–µ—Å—Ç–æ localhost:1234

3. **app/gui/task_manager.py**
   - `MarkerWorker` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `segment_with_api`
   - –ò–º–ø–æ—Ä—Ç: `from app.segmentation_api import segment_with_api`

4. **app/gui/main_window.py**
   - –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è UI: "Marker" ‚Üí "–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è"
   - –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ API

5. **app/gui/ocr_dialog.py**
   - `vlm_server_url = ""` (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

6. **app/gui/ocr_manager.py**
   - –£–¥–∞–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `api_base` –∏–∑ –≤—ã–∑–æ–≤–æ–≤

7. **requirements.txt**
   - –£–¥–∞–ª–µ–Ω–æ: `marker-pdf`, `requests`
   - –î–æ–±–∞–≤–ª–µ–Ω–æ: `httpx>=0.27.0`

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è PDF
```
PDF ‚Üí app/segmentation_api ‚Üí ngrok ‚Üí FastAPI/Docker ‚Üí Marker ‚Üí JSON
```

### OCR
```
Image ‚Üí app/ocr_engines ‚Üí ngrok ‚Üí FastAPI ‚Üí LM Studio ‚Üí Text
```

## üìã API Endpoints

1. **POST /api/v1/segment**
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç: PDF (multipart/form-data)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: JSON —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–æ–∫—É–º–µ–Ω—Ç–∞

2. **POST /api/v1/lm/chat**
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç: OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π JSON
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: Chat completion response

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è:** `app/config.py`

```python
NGROK_BASE_URL = "https://louvred-madie-gigglier.ngrok-free.dev"
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫
python -m app.main
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- Ctrl+M - —Ä–∞–∑–º–µ—Ç–∫–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- Ctrl+Shift+M - —Ä–∞–∑–º–µ—Ç–∫–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
- OCR –±–ª–æ–∫–æ–≤ (Local VLM)
- OCR —á–µ—Ä–µ–∑ OpenRouter

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

- **–£–¥–∞–ª–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** 5
- **–°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 4
- **–ò–∑–º–µ–Ω–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** 7
- **–£–¥–∞–ª–µ–Ω–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:** 2
- **–î–æ–±–∞–≤–ª–µ–Ω–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:** 1

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

1. –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–∞–π–º–∞—É—Ç **600 —Å–µ–∫—É–Ω–¥**
2. –¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
3. Ngrok endpoint –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω
4. –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ Marker
- ‚úÖ –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º LM Studio
- ‚úÖ –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (httpx)
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

## üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –°—Ç–∞—Ä—ã–µ JSON —Ä–∞–∑–º–µ—Ç–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ü—Ä–æ–º–ø—Ç—ã –∏–∑ `prompts/` —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ R2 Storage –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ OpenRouter –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

