# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–≤–∏—Å–∞–Ω–∏–π –ø—Ä–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏–∏ –±–ª–æ–∫–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏–∏ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤ –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –ø–æ–¥–≤–∏—Å–∞–Ω–∏—è –Ω–∞ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥ –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –º—ã—à–∏.

## –†–µ—à–µ–Ω–∏–µ

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ PageViewer

1. **–û—Ç–∫–ª—é—á–µ–Ω–æ BSP –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   ```python
   self.scene.setItemIndexMethod(QGraphicsScene.NoIndex)
   ```
   - –£—Å–∫–æ—Ä—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è viewport –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π**:
   ```python
   self.setViewportUpdateMode(QGraphicsView.MinimalViewportUpdate)
   self.setOptimizationFlag(QGraphicsView.DontAdjustForAntialiasing, True)
   ```

3. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ main_window**:
   - –£–±—Ä–∞–Ω–æ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ `parent().window()`
   - –†–µ–∑—É–ª—å—Ç–∞—Ç –∫–µ—à–∏—Ä—É–µ—Ç—Å—è –≤ `_main_window_cache`

4. **Throttling mouseMoveEvent**:
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –¥–æ ~120 FPS (8ms –º–µ–∂–¥—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏)
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏–∏/–≤—ã–¥–µ–ª–µ–Ω–∏–∏

### –ú–æ–Ω–∏—Ç–æ—Ä –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–î–æ–±–∞–≤–ª–µ–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

**–í–∫–ª—é—á–µ–Ω–∏–µ:**
```bash
# Windows PowerShell
$env:ENABLE_PERFORMANCE_MONITOR="1"
python app/main.py

# Linux/Mac
ENABLE_PERFORMANCE_MONITOR=1 python app/main.py
```

**–ß—Ç–æ –∏–∑–º–µ—Ä—è–µ—Ç—Å—è:**
- `mousePressEvent` - –ø–æ—Ä–æ–≥ 50ms
- `start_drawing_block` - –ø–æ—Ä–æ–≥ 50ms
- `update_rubber_band` - –ø–æ—Ä–æ–≥ 16ms (60 FPS)

**–õ–æ–≥–∏:**
```
‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è: start_drawing_block –∑–∞–Ω—è–ª–∞ 120.45ms (–ø–æ—Ä–æ–≥: 50ms)
üïê update_rubber_band: 8.32ms
```

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`app/gui/page_viewer.py`**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ `NoIndex` –¥–ª—è —Å—Ü–µ–Ω—ã
   - –ö–µ—à –¥–ª—è `main_window`
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
   - Throttling –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

2. **`app/gui/page_viewer_mouse.py`**
   - Throttling –≤ `mouseMoveEvent`
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

3. **`app/gui/performance_monitor.py`** (–Ω–æ–≤—ã–π)
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

4. **`app/main.py`**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `ENABLE_PERFORMANCE_MONITOR`

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç**:
   - –û—Ç–∫—Ä—ã—Ç—å PDF
   - –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–ª–∞–≤–Ω–æ—Å—Ç—å

2. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**:
   ```bash
   $env:ENABLE_PERFORMANCE_MONITOR="1"
   python app/main.py
   ```
   - –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –±–ª–æ–∫
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

3. **Stress test**:
   - –û—Ç–∫—Ä—ã—Ç—å PDF —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –±–ª–æ–∫–æ–≤ (>100)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å –ø—Ä–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –±–ª–æ–∫–æ–≤ (–∑–∞–º–µ–¥–ª—è–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ë–î/R2 (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏–¥–µ–æ–¥—Ä–∞–π–≤–µ—Ä—ã (OpenGL/DirectX)

## –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –£–±—Ä–∞–Ω–æ BSP –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è viewport
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ main_window
- ‚úÖ Throttling mouseMoveEvent (8ms)
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
