# PDF Annotation Tool

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è PDF-—á–µ—Ä—Ç–µ–∂–µ–π —Å OCR –∏ —ç–∫—Å–ø–æ—Ä—Ç–æ–º –≤ Markdown.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ –û—Ç–∫—Ä—ã—Ç–∏–µ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä PDF-—á–µ—Ä—Ç–µ–∂–µ–π
- ‚úÖ **–£–¥–∞–ª–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö —à—Ç–∞–º–ø–æ–≤** (–∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã)
- ‚úÖ –†—É—á–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω—ã—Ö –±–ª–æ–∫–æ–≤ (text/table/image)
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –±–ª–æ–∫–æ–≤** (Marker + Datalab API)
- ‚úÖ **OCR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ** (–õ–æ–∫–∞–ª—å–Ω—ã–µ VLM + Chandra OCR)
  - **–õ–æ–∫–∞–ª—å–Ω—ã–µ VLM —Å–µ—Ä–≤–µ—Ä—ã**: Qwen3-VL-32B, LLaVA –∏ –¥—Ä.
  - **Chandra OCR**: —Ç–∞–±–ª–∏—Ü—ã, —Ñ–æ—Ä–º—ã, —Ä—É–∫–æ–ø–∏—Å–Ω—ã–π —Ç–µ–∫—Å—Ç, –ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ç–∫–∏ –≤ JSON
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –∫—Ä–æ–ø–æ–≤ –±–ª–æ–∫–æ–≤ –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Markdown –æ—Ç—á—ë—Ç–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å —Ä–∞–∑–º–µ—Ç–∫–∏ –Ω–∞ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é PDF
- ‚úÖ –°–±–æ—Ä–∫–∞ –≤ .exe —Å PyInstaller

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python 3.11

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install -r requirements.txt
```

### 3. OCR –¥–≤–∏–∂–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω—ã–π VLM —Å–µ—Ä–≤–µ—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ Qwen3-VL-32B –∏–ª–∏ –¥—Ä—É–≥—É—é VLM –º–æ–¥–µ–ª—å –Ω–∞ `http://127.0.0.1:1234`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ LM Studio, vLLM –∏–ª–∏ Ollama
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [`docs/LOCAL_VLM_OCR.md`](docs/LOCAL_VLM_OCR.md)

**–í–∞—Ä–∏–∞–Ω—Ç 2: Chandra OCR**
```bash
pip install chandra-ocr
```
- GPU —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [`docs/CHANDRA_OCR.md`](docs/CHANDRA_OCR.md)

### 4. Datalab API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏ —á–µ—Ä–µ–∑ Datalab API:
```bash
set DATALAB_API_KEY=–≤–∞—à_api_–∫–ª—é—á
```
- –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á –Ω–∞ [datalab.to](https://www.datalab.to/)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [`docs/DATALAB_API_INTEGRATION.md`](docs/DATALAB_API_INTEGRATION.md)

## –ó–∞–ø—É—Å–∫

```bash
python app/main.py
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- **–§–∞–π–ª –ª–æ–≥–æ–≤:** `logs/app.log` (–≤—Å–µ —Å–æ–±—ã—Ç–∏—è —Å —É—Ä–æ–≤–Ω–µ–º INFO –∏ –≤—ã—à–µ)
- **–ö–æ–Ω—Å–æ–ª—å:** –≤—ã–≤–æ–¥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏–∑–º–µ–Ω–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å –≤ `app/main.py`:
```python
setup_logging(log_level=logging.DEBUG)  # –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
RD/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ models.py               # –î–∞—Ç–∞-–∫–ª–∞—Å—Å—ã (Document, Page, Block)
‚îÇ   ‚îú‚îÄ‚îÄ pdf_utils.py            # –†–∞–±–æ—Ç–∞ —Å PDF (PyMuPDF)
‚îÇ   ‚îú‚îÄ‚îÄ annotation_io.py        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ JSON
‚îÇ   ‚îú‚îÄ‚îÄ cropping.py             # –û–±—Ä–µ–∑–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ ocr.py                  # OCR (pytesseract)
‚îÇ   ‚îú‚îÄ‚îÄ report_md.py            # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Markdown
‚îÇ   ‚îú‚îÄ‚îÄ auto_segmentation.py    # –ê–≤—Ç–æ-—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è (OpenCV)
‚îÇ   ‚îú‚îÄ‚îÄ reapply.py              # –ü–µ—Ä–µ–Ω–æ—Å —Ä–∞–∑–º–µ—Ç–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ gui/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ main_window.py      # –ì–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ
‚îÇ       ‚îî‚îÄ‚îÄ page_viewer.py      # –í–∏–¥–∂–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –û—Ç–∫—Ä—ã—Ç–∏–µ PDF
- –ù–∞–∂–º–∏—Ç–µ "–û—Ç–∫—Ä—ã—Ç—å PDF" –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª
- –°—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç–æ–±—Ä–∞–∑—è—Ç—Å—è –≤ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
- **–î–ª—è –±–æ–ª—å—à–∏—Ö PDF:** –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

### 2. –£–¥–∞–ª–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö —à—Ç–∞–º–ø–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Üí –£–¥–∞–ª–∏—Ç—å —à—Ç–∞–º–ø—ã** (–∏–ª–∏ Ctrl+D)
- –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã PDF (–∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã)
- –í—ã–±–µ—Ä–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
- –ù–∞–∂–º–∏—Ç–µ "–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ"
- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [`docs/STAMP_REMOVAL.md`](docs/STAMP_REMOVAL.md)

### 3. –†—É—á–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ –±–ª–æ–∫–æ–≤
- –ù–∞—Ä–∏—Å—É–π—Ç–µ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –º—ã—à—å—é –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- –í –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏ –∑–∞–¥–∞–π—Ç–µ —Ç–∏–ø –±–ª–æ–∫–∞ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ
- –ù–∞–≤–∏–≥–∞—Ü–∏—è: –∫–Ω–æ–ø–∫–∏ "–ü—Ä–µ–¥." / "–°–ª–µ–¥."

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è

**Marker (–ª–æ–∫–∞–ª—å–Ω–æ):**
- –ù–∞–∂–º–∏—Ç–µ "Marker —Ä–∞–∑–º–µ—Ç–∫–∞" (Ctrl+M) –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ò–ª–∏ "Marker (–≤—Å–µ —Å—Ç—Ä.)" (Ctrl+Shift+M) –¥–ª—è –≤—Å–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- –ë–ª–æ–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

**Datalab API (–æ–±–ª–∞—á–Ω–æ):**
- –ù–∞–∂–º–∏—Ç–µ "Datalab —Ä–∞–∑–º–µ—Ç–∫–∞" (Ctrl+D) –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ò–ª–∏ "Datalab (–≤—Å–µ —Å—Ç—Ä.)" (Ctrl+Shift+D) –¥–ª—è –≤—Å–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- –¢—Ä–µ–±—É–µ—Ç—Å—è API –∫–ª—é—á –æ—Ç [datalab.to](https://www.datalab.to/)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [`docs/DATALAB_API_INTEGRATION.md`](docs/DATALAB_API_INTEGRATION.md)

### 5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ç–∫–∏
- "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ç–∫—É" ‚Üí blocks.json
- "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞–∑–º–µ—Ç–∫—É" ‚Üí –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π blocks.json

### 6. OCR —Å —É—á–µ—Ç–æ–º —Ç–∏–ø–æ–≤ –±–ª–æ–∫–æ–≤
- **"–ó–∞–ø—É—Å—Ç–∏—Ç—å OCR"** (Ctrl+R) ‚Üí –≤—ã–±–æ—Ä –¥–≤–∏–∂–∫–∞ –∏ —Ä–µ–∂–∏–º–∞:

**–î–≤–∏–∂–∫–∏ OCR:**
1. **–õ–æ–∫–∞–ª—å–Ω—ã–π VLM —Å–µ—Ä–≤–µ—Ä** (Qwen3-VL –∏ –¥—Ä.)
   - URL: `http://127.0.0.1:1234/v1`
   - –ú–æ–¥–µ–ª—å: `qwen3-vl-32b-instruct`
   - –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ä—É—Å—Å–∫–∏–º —è–∑—ã–∫–æ–º
2. **Chandra OCR**
   - HuggingFace (–ª–æ–∫–∞–ª—å–Ω–æ) –∏–ª–∏ vLLM —Å–µ—Ä–≤–µ—Ä
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**–†–µ–∂–∏–º—ã:**
- **–ü–æ –±–ª–æ–∫–∞–º**: —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Å —É—á–µ—Ç–æ–º —Ç–∏–ø–∞ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞
  - TEXT/TABLE: OCR —á–µ—Ä–µ–∑ Chandra/Qwen
  - IMAGE: –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- **–í—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ —Ç–∏–ø–∞–º:**
- ‚úÖ TEXT/TABLE: —Ç–∞–±–ª–∏—Ü—ã –≤ Markdown, —Ñ–æ—Ä–º—ã, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ IMAGE: –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ + —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫—Ä–æ–ø
- ‚úÖ –†—É–∫–æ–ø–∏—Å–Ω—ã–π —Ç–µ–∫—Å—Ç
- ‚úÖ –ü–æ–ª–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ layout

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤:**
- –ü—Ä–æ–º–ø—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `prompts/`
- –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.txt` —Ñ–∞–π–ª—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OCR
- –ü–æ–¥—Ä–æ–±–Ω–µ–µ: [`prompts/README.md`](prompts/README.md)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Markdown –¥–æ–∫—É–º–µ–Ω—Ç
- –ö—Ä–æ–ø—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ `temp_crops/`
- –û–ø–∏—Å–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [`docs/MARKER_OCR_INTEGRATION.md`](docs/MARKER_OCR_INTEGRATION.md)

### 7. –≠–∫—Å–ø–æ—Ä—Ç
- "–≠–∫—Å–ø–æ—Ä—Ç –∫—Ä–æ–ø–æ–≤" ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–ª–æ–∫–æ–≤ –≤ –ø–∞–ø–∫–∏:
  ```
  output/
    text/src/
    table/src/
    image/src/
  ```
- "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è MD" ‚Üí —Å–æ–∑–¥–∞—Ç—å Markdown –æ—Ç—á—ë—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

### 8. –ü–µ—Ä–µ–Ω–æ—Å —Ä–∞–∑–º–µ—Ç–∫–∏
- –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç–∞—Ä—É—é —Ä–∞–∑–º–µ—Ç–∫—É (blocks.json)
- "–ü–µ—Ä–µ–Ω–æ—Å —Ä–∞–∑–º–µ—Ç–∫–∏" ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π PDF
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –±–ª–æ–∫–æ–≤ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã

## –°–±–æ—Ä–∫–∞ –≤ EXE

```bash
pyinstaller --onefile --windowed --name="PDFAnnotation" app/main.py
```

–ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –±—É–¥–µ—Ç –≤ –ø–∞–ø–∫–µ `dist/`.

## –ú–æ–¥—É–ª–∏ –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

| –ú–æ–¥—É–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|--------|-----------|------------|
| `models.py` | –î–∞—Ç–∞-–∫–ª–∞—Å—Å—ã –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞, —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –±–ª–æ–∫–æ–≤ | –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ JSON |
| `pdf_utils.py` | –û—Ç–∫—Ä—ã—Ç–∏–µ PDF –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü —á–µ—Ä–µ–∑ PyMuPDF | ‚ú® –§—É–Ω–∫—Ü–∏–∏ + –∫–ª–∞—Å—Å, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ |
| `annotation_io.py` | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–∑–º–µ—Ç–∫–∏ –≤ JSON | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π |
| `cropping.py` | –û–±—Ä–µ–∑–∫–∞ –±–ª–æ–∫–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è | –ü—Ä–æ–≥—Ä–µ—Å—Å-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `ocr.py` | OCR –¥–≤–∏–∂–∫–∏ (LocalVLM + Chandra) | –í—ã—Å–æ–∫–æ—Ç–æ—á–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ |
| `report_md.py` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Markdown –æ—Ç—á—ë—Ç–æ–≤ | –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º |
| `auto_segmentation.py` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤ (OpenCV) | –≠–≤—Ä–∏—Å—Ç–∏–∫–∏ –¥–ª—è —Ç–∏–ø–æ–≤ –±–ª–æ–∫–æ–≤ |
| `reapply.py` | –ü–µ—Ä–µ–Ω–æ—Å —Ä–∞–∑–º–µ—Ç–∫–∏ –Ω–∞ –Ω–æ–≤—ã–π PDF | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç |
| `gui/main_window.py` | –ì–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ |
| `gui/page_viewer.py` | –í–∏–¥–∂–µ—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –∏ —Ä–∏—Å–æ–≤–∞–Ω–∏—è –±–ª–æ–∫–æ–≤ | –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ä–∏—Å–æ–≤–∞–Ω–∏–µ |

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- **[Marker + OCR workflow](docs/QUICK_START_MARKER_OCR.md)** ‚Äî —Ä–∞–∑–º–µ—Ç–∫–∞ –∏ OCR –ø–æ —Ç–∏–ø–∞–º –±–ª–æ–∫–æ–≤ ‚≠ê
- **[–ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](docs/QUICK_START.md)** ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ OCR
- **[Marker + OCR –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](docs/MARKER_OCR_INTEGRATION.md)** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ —Ç–∏–ø–∞–º –±–ª–æ–∫–æ–≤
- **[Datalab API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](docs/DATALAB_API_INTEGRATION.md)** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ —á–µ—Ä–µ–∑ API ‚≠ê
- **[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ OCR](docs/PROMPTS_CUSTOMIZATION.md)** ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ ‚≠ê
- **[Chandra OCR](docs/CHANDRA_OCR.md)** ‚Äî –≤—ã—Å–æ–∫–æ—Ç–æ—á–Ω–∞—è –º–æ–¥–µ–ª—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **[–õ–æ–∫–∞–ª—å–Ω—ã–µ VLM](docs/LOCAL_VLM_OCR.md)** ‚Äî Qwen3-VL –∏ –¥—Ä—É–≥–∏–µ
- **[–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π](docs/IMAGE_RECOGNITION.md)** ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **[PDF –†–µ–Ω–¥–µ—Ä–∏–Ω–≥](docs/pdf_rendering.md)** ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ `pdf_utils.py`
- **[–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö](docs/DATA_MODELS.md)** ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Block, PageModel, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
- **[Marker + OCR workflow](examples/test_marker_ocr_workflow.py)** ‚Äî –ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä
- **[PDF —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥](examples/test_pdf_rendering.py)** ‚Äî –ø—Ä–∏–º–µ—Ä—ã —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
- **[–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö](examples/test_models.py)** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –±–ª–æ–∫–∞–º–∏

## üîß API –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### 1. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ PDF

```python
from app.pdf_utils import open_pdf, render_page_to_image, render_all_pages

# –û—Ç–∫—Ä—ã—Ç—å PDF
doc = open_pdf("document.pdf")  # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤—Å—Ç—Ä–æ–µ–Ω–∞

# –û–¥–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
image = render_page_to_image(doc, page_index=0, zoom=2.0)

# –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
images = render_all_pages(doc, zoom=2.0)

doc.close()
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã zoom:** `1.0` (72 DPI), `2.0` (144 DPI) ‚≠ê, `3.0` (216 DPI)

### 2. –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

```python
from app.models import Block, BlockType, BlockSource, PageModel

# –°–æ–∑–¥–∞—Ç—å –±–ª–æ–∫ —Å –¥–≤—É–º—è —Å–∏—Å—Ç–µ–º–∞–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
block = Block.create(
    page_index=0,
    coords_px=(100, 200, 500, 600),  # –ü–∏–∫—Å–µ–ª–∏: x1, y1, x2, y2
    page_width=1600,
    page_height=2400,
    category="–ó–∞–≥–æ–ª–æ–≤–æ–∫",
    block_type=BlockType.TEXT,
    source=BlockSource.USER
)

# coords_norm –≤—ã—á–∏—Å–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (0..1)
print(block.coords_norm)  # (0.0625, 0.0833, 0.3125, 0.25)

# –ú–æ–¥–µ–ª—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
page = PageModel(page_index=0, image=image)
page.add_block(block)

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–ª–æ–∫–æ–≤
text_blocks = page.get_blocks_by_type(BlockType.TEXT)
user_blocks = page.get_blocks_by_source(BlockSource.USER)
```

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ ID –±–ª–æ–∫–æ–≤ (UUID)
- –î–≤–æ–π–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç: –ø–∏–∫—Å–µ–ª–∏ + –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ (0..1)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞—Ç–∞–º–∏
- –ü–µ—Ä–µ–Ω–æ—Å —Ä–∞–∑–º–µ—Ç–∫–∏ –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏ PDF —á–µ—Ä–µ–∑ norm –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- PDF: [`docs/pdf_rendering.md`](docs/pdf_rendering.md)
- –ú–æ–¥–µ–ª–∏: [`docs/DATA_MODELS.md`](docs/DATA_MODELS.md)

---

## –ù–µ–¥–∞–≤–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

1. ‚úÖ **–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ –ø—Ä–æ–º–ø—Ç—ã OCR** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª—ã –≤ `prompts/`
2. ‚úÖ **Marker + OCR –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–æ–∫–æ–≤ –ø–æ —Ç–∏–ø–∞–º
3. ‚úÖ **IMAGE —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —á–µ—Ä–µ–∑ Qwen
4. ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Markdown** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
5. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Chandra OCR

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –£–ª—É—á—à–µ–Ω–∏–µ –∞–≤—Ç–æ—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ (ML-–º–æ–¥–µ–ª–∏)
2. –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –∏ —É–¥–æ–±—Å—Ç–≤–∞ UI
3. –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö PDF
4. –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
5. –≠–∫—Å–ø–æ—Ä—Ç –≤ –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã (DOCX, HTML)

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**Python:** 3.11  
**GUI:** PySide6

